@model Forum.Models.Subject
@{
    ViewBag.Title = "Afisare subiect";
}

<h2> @ViewBag.Title </h2>

<body onload="Initialize()"> </body>

<div class="panel panel-default">
    @Html.Partial("SubjectInfo", Model)

    <p id="p_vote_count">Vote count: </p>
    <input id="vote_btn" class="btn btn-success" type="button" onclick='Vote()' value="Vote">
    <input id="clear_btn" class="btn btn-success" type="button" onclick='Clear()' value="Clear">

    <a class="btn btn-success" href="/Subject/Edit/@Model.SubjectId">Editare subiect</a>

    <div style="display: inline-block">
        @using (Html.BeginForm(actionName: "Delete", controllerName: "Subject", routeValues: new
        {
            id = Model.SubjectId
        }))
        {
            @Html.HttpMethodOverride(HttpVerbs.Delete)

            <button class="btn btn-success" type="submit">Sterge subiectul</button>
        }
    </div>
</div>

<a class="btn btn-info" href="/Category/Show/@Model.CategoryId">All category subjects</a>
<a class="btn btn-info" href="/Subject/CreateComment/@Model.SubjectId">Add a new comment in this subject</a>

<br /> <br />

<div>

    @for (int i = 0; i < ViewBag.Comments.Count; ++i)
    {
        Forum.Models.Comment comment = ViewBag.Comments[i];
        string divId = $"comment{i}";

        <text>
    <div id="@divId" class="commentDiv" CommentId="@comment.CommentId" style="border: 2px solid black; margin: 20px 0px;">
        @Html.Partial("CommentInfo", comment)

        <p class="p_vote_count" style="display: inline-block;"></p>
        <div>
            @if (Request.IsAuthenticated) {
                <input class="btn btn-success vote_btn" type="button" onclick="VoteComment('@divId', @comment.CommentId)" value="Vote" style="display: none;">
            }
            @if (Request.IsAuthenticated && User.IsInRole("Administrator")) {
                <input class="btn btn-success clear_btn" type="button" onclick="ClearComment('@divId', @comment.CommentId)" value="Clear" style="display: inline-block;">
            }
        </div>

        @if (ViewBag.UserId == comment.UserId)
        {
            <a class="btn btn-success" href="/Comment/Edit/@comment.CommentId">Edit</a>
        }

        @if (ViewBag.UserId == comment.UserId || ViewBag.UserCanDelete)
        {
            <form method="post" action="/Comment/Delete/@comment.CommentId" style="display: inline-block;">
                @Html.HttpMethodOverride(HttpVerbs.Delete)

                <button class="btn btn-danger" type="submit">Delete</button>
            </form>
        }
    </div>
        </text>
    }

</div>

<br /> <br />

<br />
<hr />
<br />
















<script type="text/javascript">
    function Vote() {
        $.ajax({
            type: 'GET',
            url: '/UpvoteSubject/Vote',
            data: { 'subjectId': JSON.stringify(@Model.SubjectId) },
            success: function (result) {
                var tmp = JSON.parse(result);

                document.getElementById("vote_btn").value = tmp.VoteText;
                document.getElementById("p_vote_count").innerHTML = "Vote count: " + tmp.VoteCount;
            },
            error: function (result) {
                alert("Error " + result)
            }
        });
    }
    function Clear() {
        $.ajax({
            type: 'GET',
            url: '/UpvoteSubject/Clear',
            success: function (result) {
                alert(result);
            }
        });
    }
    function Initialize() {
        $.ajax({
            type: 'GET',
            url: '/UpvoteSubject/Initialize',
            data: { 'subjectId': JSON.stringify(@Model.SubjectId) },
            success: function (result) {
                var tmp = JSON.parse(result);

                document.getElementById("vote_btn").value = tmp.VoteText;
                document.getElementById("p_vote_count").innerHTML = "Vote count: " + tmp.VoteCount;
            }
        });
    }
</script>





@Html.Partial("CommentUpvoteScript", Model)