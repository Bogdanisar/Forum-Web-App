@model Forum.Models.Subject
@{
    ViewBag.Title = "Afisare subiect";
}

<h2> @ViewBag.Title </h2>

<div class="panel panel-default form-and-dropdown-wrapper">
    @Html.Partial("SubjectInfo", Model)

    @if (ViewBag.UserId == Model.UserId || User.IsInRole("Moderator") || User.IsInRole("Administrator")) { 
        <div class="panel-footer article-panel-footer">

            @if (ViewBag.UserId == Model.UserId)
            {
                <a class="btn btn-primary" href="/Subject/Edit/@Model.SubjectId">Edit subject</a>

                <form action="/Subject/Delete" method="post">
                    @Html.HttpMethodOverride(HttpVerbs.Delete)

                    @Html.Hidden("id", Model.SubjectId)

                    <button class="btn btn-danger" type="submit">Delete subject</button>
                </form>
            }


            <div style="display: none">
                @using (Html.BeginForm(actionName: "Delete", controllerName: "Subject", routeValues: new
                {
                    id = Model.SubjectId
                }))
                {
                    @Html.HttpMethodOverride(HttpVerbs.Delete)
                }
            </div>

            @if (User.IsInRole("Moderator") || User.IsInRole("Administrator")) {
                <div class="dropdown">
                    <button class="btn btn-warning dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        Sudo
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                        @if (User.IsInRole("Administrator"))
                        {
                            <li class="dropdown-header">Admin</li>
                            <li><a href="/Subject/Edit/@Model.SubjectId">Edit subject</a></li>
                            <li><a href="#" class="dropdown-delete">Delete subject</a></li>
                            <li><a href="#" onclick='Clear(@Model.SubjectId)'>Clear votes</a></li>
                            <li role="separator" class="divider"></li>
                        }
                        <li class="dropdown-header">Moderator</li>
                        <li><a href="/Subject/EditCategory/@Model.SubjectId">Edit subject category</a></li>
                    </ul>
                </div>
            }

        </div>
    }
</div>

<hr />

<a class="btn btn-info" href="/Category/Show/@Model.CategoryId">All category subjects</a>
<a class="btn btn-info" href="/Subject/CreateComment/@Model.SubjectId">Add a new comment in this subject</a>


<div>

    @for (int i = 0; i < ViewBag.Comments.Count; ++i)
    {
        Forum.Models.Comment comment = ViewBag.Comments[i];
        string divId = $"comment{i}";

        <text>
            <div id="@divId" class="commentDiv" CommentId="@comment.CommentId" style="border: 2px solid black; margin: 20px 0px;">
                @Html.Partial("CommentInfo", comment)

                <p class="p_vote_count" style="display: inline-block;"></p>
                <div>
                    @if (Request.IsAuthenticated)
                    {
                        <input class="btn btn-success vote_btn" type="button" onclick="VoteComment('@divId', @comment.CommentId)" value="Vote" style="display: none;">
                    }
                    @if (Request.IsAuthenticated && User.IsInRole("Administrator"))
                    {
                        <input class="btn btn-success clear_btn" type="button" onclick="ClearComment('@divId', @comment.CommentId)" value="Clear" style="display: inline-block;">
                    }
                </div>

                @if (ViewBag.UserId == comment.UserId)
                {
                    <a class="btn btn-success" href="/Comment/Edit/@comment.CommentId">Edit</a>
                }

                @if (ViewBag.UserId == comment.UserId || User.IsInRole("Administrator") || User.IsInRole("Moderator"))
                {
                    <form method="post" action="/Comment/Delete/@comment.CommentId" style="display: inline-block;">
                        @Html.HttpMethodOverride(HttpVerbs.Delete)

                        <button class="btn btn-danger" type="submit">Delete</button>
                    </form>
                }
            </div>
        </text>
    }

</div>








@Html.Partial("CommentUpvoteScript", Model)
